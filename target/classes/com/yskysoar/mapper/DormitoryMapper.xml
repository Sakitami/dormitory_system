<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yskysoar.mapper.DormitoryMapper">


    <select id="availableList" resultType="Dormitory">
        SELECT id,
               name
        FROM dormitory
        WHERE available > 0;
    </select>

    <update id="subAvailable">
        UPDATE dormitory
        SET available = available - 1
        WHERE id = #{id};
    </update>

    <insert id="addAvailable">
        UPDATE dormitory
        SET available = available + 1
        WHERE id = #{id};
    </insert>

    <select id="findDormitoryByBuildingId" resultType="java.lang.Integer">
        SELECT id
        FROM dormitory
        WHERE building_id = #{buildingId};
    </select>

    <select id="findAvailableDormitoryId" resultType="java.lang.Integer">
        SELECT id
        FROM dormitory
        WHERE available > 0
        LIMIT 0, 1;
    </select>

    <delete id="delete">
        DELETE
        FROM dormitory
        WHERE id = #{id};
    </delete>

    <select id="list" resultType="Dormitory">
        SELECT d.id,
               b.name AS buildingName,
               d.name,
               d.type,
               d.available,
               d.telephone
        FROM dormitory d,
             building b
        WHERE d.building_id = b.id;
    </select>

    <select id="searchByName" resultType="Dormitory">
        SELECT d.id,
               b.name AS buildingName,
               d.name,
               d.type,
               d.available,
               d.telephone
        FROM dormitory d,
             building b
        WHERE d.building_id = b.id
          AND d.name LIKE CONCAT('%', #{value}, '%');
    </select>

    <select id="searchByTelephone" resultType="Dormitory">
        SELECT d.id,
               b.name AS buildingName,
               d.name,
               d.type,
               d.available,
               d.telephone
        FROM dormitory d,
             building b
        WHERE d.building_id = b.id
          AND d.telephone LIKE CONCAT('%', #{value}, '%');
    </select>

    <insert id="save">
        INSERT INTO dormitory (building_id, name, type, available, telephone)
        VALUES (#{buildingId}, #{name}, #{type}, #{available}, #{telephone});
    </insert>

    <update id="update">
        UPDATE dormitory
        SET name      = #{name},
            telephone = #{telephone}
        WHERE id = #{id};
    </update>

    <select id="findBuildingId" resultType="Dormitory">
        SELECT id,
               name
        FROM dormitory
        WHERE building_id = #{buildingId};
    </select>


</mapper>
